<!DOCTYPE html>  
<html>  
    <head>
		<title> RND SPARK - Smart Controller </title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="shortcut icon" type="image/x-icon" href="image/favicon.ico" />
		<!-- Bootstrap -->
		<link href="css/style.css" rel="stylesheet">

		<style>
			/* NOTE: The styles were added inline because Prefixfree needs access to your styles and they must be inlined if they are on local disk! */
			@import "https://fonts.googleapis.com/css?family=Ubuntu:400,700italic";
			@import "https://fonts.googleapis.com/css?family=Cabin:400";
			* {
			  box-sizing: border-box;
			}

			html {
			  background-image: url("image/default.jpg");
			  background-size: cover;
			  font-size: 10px;
			  height: 100%;
			  overflow: hidden;
			  position: absolute;
			  text-align: center;
			  width: 100%;
			}

			/* =========================================
			Stark Industries Logo
			========================================= */
			#logo {
			  animation: logo-entry 4s ease-in;
			  width: 250px;
			  margin: 0 auto;
			  position: relative;
			  z-index: 40;
			}

			h1 {
			  animation: text-glow 2s ease-out infinite alternate;
			  font-family: 'Ubuntu', sans-serif;
			  color: #00a4a2;
			  font-size: 4.0rem;
			  font-weight: bold;
			  position: absolute;
			  text-shadow: 0 0 10px #000, 0 0 20px #000, 0 0 30px #000, 0 0 40px #000, 0 0 50px #000, 0 0 60px #000, 0 0 70px #000;
			  top: 50px;
			}
			h1:before {
			  animation: before-glow 2s ease-out infinite alternate;
			  border-left: 535px solid transparent;
			  border-bottom: 10px solid #00a4a2;
			  content: ' ';
			  height: 0;
			  position: absolute;
			  right: -74px;
			  top: -10px;
			  width: 0;
			}
			h1:after {
			  animation: after-glow 2s ease-out infinite alternate;
			  border-left: 100px solid transparent;
			  border-top: 16px solid #00a4a2;
			  content: ' ';
			  height: 0;
			  position: absolute;
			  right: -85px;
			  top: 24px;
			  transform: rotate(-47deg);
			  width: 0;
			}

			/* =========================================
			Log in form
			========================================= */
			#fade-box {
			  animation: input-entry 3s ease-in;
			  z-index: 4;
			}

			.stark-login form {
			  animation: form-entry 3s ease-in-out;
			  background: #111;
			  background: linear-gradient(#004746, #111111);
			  border: 6px solid #00a4a2;
			  box-shadow: 0 0 15px #00fffd;
			  border-radius: 5px;
			  display: inline-block;
			  height: auto;
			  margin: 200px auto 0;
			  position: relative;
			  z-index: 4;
			  width: 250px;
			  transition: 1s all;
			  padding-bottom: 15px;
			}
			.stark-login form:hover {
			  border: 6px solid #00fffd;
			  box-shadow: 0 0 25px #00fffd;
			  transition: 1s all;
			}
			.stark-login select {
			  background: #222;
			  background: linear-gradient(#333333, #222222);
			  border: 1px solid #444;
			  border-radius: 5px;
			  box-shadow: 0 2px 0 #000;
			  color: #888;
			  display: block;
			  font-family: 'Cabin', helvetica, arial, sans-serif;
			  font-size: 13px;
			  font-size: 1.3rem;
			  height: 40px;
			  margin: 20px auto 10px;
			  padding: 0 10px;
			  text-shadow: 0 -1px 0 #000;
			  width: 200px;
			}
			.stark-login select:focus {
			  animation: box-glow 1s ease-out infinite alternate;
			  background: #0B4252;
			  background: linear-gradient(#333933, #222922);
			  border-color: #00fffc;
			  box-shadow: 0 0 5px rgba(0, 255, 253, 0.2), inset 0 0 5px rgba(0, 255, 253, 0.1), 0 2px 0 #000;
			  color: #CCC;
			  outline: none;
			}
			.stark-login select:invalid {
			  border: 2px solid red;
			  box-shadow: 0 0 5px rgba(255, 0, 0, 0.2), inset 0 0 5px rgba(255, 0, 0, 0.1), 0 2px 0 #000;
			}
			.stark-login button {
			  animation: input-entry 0s ease-in;
			  background: #222;
			  background: linear-gradient(#333333, #222222);
			  box-sizing: content-box;
			  border: 1px solid #444;
			  border-left-color: #000;
			  border-radius: 5px;
			  box-shadow: 0 2px 0 #000;
			  color: #fff;
			  display: block;
			  font-family: 'Cabin', helvetica, arial, sans-serif;
			  font-size: 13px;
			  font-weight: 400;
			  height: 40px;
			  line-height: 40px;
			  margin: 20px auto;
			  padding: 0;
			  position: relative;
			  text-shadow: 0 -1px 0 #000;
			  width: 200px;
			  transition: 1s all;
			}
			.stark-login button:hover,
			.stark-login button:focus {
			  background: #0C6125;
			  background: linear-gradient(#393939, #292929);
			  color: #00fffc;
			  outline: none;
			  transition: 1s all;
			}
			.stark-login button:active {
			  background: #292929;
			  background: linear-gradient(#393939, #292929);
			  box-shadow: 0 1px 0 #000, inset 1px 0 1px #222;
			  top: 1px;
			}

			/* =========================================
			Spinner
			========================================= */
			#circle1 {
			  animation: circle1 4s linear infinite, circle-entry 6s ease-in-out;
			  background: #000;
			  border-radius: 50%;
			  border: 10px solid #00a4a2;
			  box-shadow: 0 0 0 2px black, 0 0 0 6px #00fffc;
			  height: 250px;
			  width: 250px;
			  position: absolute;
			  top: 20px;
			  left: 50%;
			  margin-left: -250px;
			  overflow: hidden;
			  opacity: 0.4;
			  z-index: -3;
			}

			#inner-cirlce1 {
			  background: #000;
			  border-radius: 50%;
			  border: 36px solid #00fffc;
			  height: 460px;
			  width: 460px;
			  margin: 10px;
			}
			#inner-cirlce1:before {
			  content: ' ';
			  width: 240px;
			  height: 480px;
			  background: #000;
			  position: absolute;
			  top: 0;
			  left: 0;
			}
			#inner-cirlce1:after {
			  content: ' ';
			  width: 480px;
			  height: 240px;
			  background: #000;
			  position: absolute;
			  top: 0;
			  left: 0;
			}

			/* =========================================
			Hexagon Mesh
			========================================= */
			.hexagons {
			  animation: logo-entry 4s ease-in;
			  color: #000;
			  font-size: 52px;
			  font-size: 5.1rem;
			  letter-spacing: -0.2em;
			  line-height: 0.7;
			  position: absolute;
			  text-shadow: 0 0 6px #00fffc;
			  top: 310px;
			  width: 100%;
			  transform: perspective(600px) rotateX(60deg) scale(1.4);
			  z-index: -3;
			}

			/* =========================================
			Animation Keyframes
			========================================= */
			@keyframes logo-entry {
			  0% {
				opacity: 0;
			  }
			  80% {
				opacity: 0;
			  }
			  100% {
				opacity: 1;
			  }
			}
			@keyframes circle-entry {
			  0% {
				opacity: 0;
			  }
			  20% {
				opacity: 0;
			  }
			  100% {
				opacity: 0.4;
			  }
			}
			@keyframes input-entry {
			  0% {
				opacity: 0;
			  }
			  90% {
				opacity: 0;
			  }
			  100% {
				opacity: 1;
			  }
			}
			@keyframes form-entry {
			  0% {
				height: 0;
				width: 0;
				opacity: 0;
				padding: 0;
			  }
			  20% {
				height: 0;
				border: 1px solid #00a4a2;
				width: 0;
				opacity: 0;
				padding: 0;
			  }
			  40% {
				width: 0;
				height: 170px;
				border: 6px solid #00a4a2;
				opacity: 1;
				padding: 0;
			  }
			  100% {
				height: 170px;
				width: 250px;
			  }
			}
			@keyframes box-glow {
			  0% {
				border-color: #00b8b6;
				box-shadow: 0 0 5px rgba(0, 255, 253, 0.2), inset 0 0 5px rgba(0, 255, 253, 0.1), 0 2px 0 #000;
			  }
			  100% {
				border-color: #00fffc;
				box-shadow: 0 0 20px rgba(0, 255, 253, 0.6), inset 0 0 10px rgba(0, 255, 253, 0.4), 0 2px 0 #000;
			  }
			}
			@keyframes text-glow {
			  0% {
				color: #00a4a2;
				text-shadow: 0 0 10px #000, 0 0 20px #000, 0 0 30px #000, 0 0 40px #000, 0 0 50px #000, 0 0 60px #000, 0 0 70px #000;
			  }
			  100% {
				color: #00fffc;
				text-shadow: 0 0 20px rgba(0, 255, 253, 0.6), 0 0 10px rgba(0, 255, 253, 0.4), 0 2px 0 #000;
			  }
			}
			@keyframes before-glow {
			  0% {
				border-bottom: 10px solid #00a4a2;
			  }
			  100% {
				border-bottom: 10px solid #00fffc;
			  }
			}
			@keyframes after-glow {
			  0% {
				border-top: 16px solid #00a4a2;
			  }
			  100% {
				border-top: 16px solid #00fffc;
			  }
			}
			@keyframes circle1 {
			  0% {
				-moz-transform: rotate(0deg);
				-ms-transform: rotate(0deg);
				-webkit-transform: rotate(0deg);
				transform: rotate(0deg);
			  }
			  100% {
				-moz-transform: rotate(360deg);
				-ms-transform: rotate(360deg);
				-webkit-transform: rotate(360deg);
				transform: rotate(360deg);
			  }
			}
			
			#table_log {
				width:98%; 
				margin:1%;		
				display: none;
			}
			
			table {
				width: 100%;
				border-collapse: collapse;
				border-spacing: 0;
				margin-top: 30px;
			}

			td, th {
				text-align: left;
				padding: 8px;
				background-color: #FFF;
			}

			tr:nth-child(even) {
				background-color: #CCC;
			}
			
			thead, tbody, tr, td, th { display: block; }

			tr:after {
				content: ' ';
				display: block;
				visibility: hidden;
				clear: both;
			}

			thead th { 
				height: 30px;
				line-height: 30px;
				/*text-align: left;*/
			}

			tbody {
				height: 100px;
				overflow-y: auto;
			}

			thead {
				/* fallback */
				width: 97%;
				/* minus scroll bar width */
				width: calc(100% - 17px);
			}

			tbody td, thead th {
				float: left;
			}

			tbody td:last-child, thead th:last-child {
				border-right: none;
			}

		</style>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js"></script>
    </head>
    <body>
	
		<div id="logo"> 
			<h1><i> RND SPARK </i></h1>
		</div>
	
        <section class="stark-login">
			<form>	
				<div id="fade-box">
					<select id="control_slc" onchange="changeControlSelection(this)">
						<option value="default" selected>Select</option>
						<option value="smartbotanica">Smart Botanica</option>
						<option value="smartwindow">Smart Window</option>
					</select>
					<button type="button" id="read_btn" onclick="submitAction('Read Sensor')" style="display:none;">Read Sensor</button>
					<button type="button" id="trigger_btn" onclick="submitAction('Trigger Pump')" style="display:none;">Trigger Pump</button>					
				</div>
			</form>
			
			<form id="trigger_form" style="display:none;">
				<input id="trigger_value" type="text">
			</form>
			
			<div id="table_log" align="center">
				<table>
					<thead>
						<tr>
							<th width="38%">Timestamp</th>
							<th width="32%">Soil moistness</th> 
							<th width="30%">Action</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
			
		</section>

        <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>

        <script>

						var project_value = "";
						var trigger_value = "";
						var sensor_value = "";

						// initializing socket, connection to server
						//var socket = io.connect('http://localhost:7777');
						var socket = io.connect('https://smartbotanica.mybluemix.net/');
						socket.on('connect', function(data) {
							socket.emit('join', 'Hello server from client');
						});

						// listener for 'thread' event, which updates trigger_value
						socket.on('thread', function(data) {

							var parameter_array = data.split('##');
					
							project_value = parameter_array[0];
							trigger_value = parameter_array[1];
							sensor_value = parameter_array[2];

							rowdata = "<tr><td width='38%'>"+current_timestamp+"</td><td width='32%'>"+sensor_value+"</td><td width='30%'>"+trigger_value+"</td></tr>";

							$("#table_log tbody").prepend(rowdata);

							if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) == false) 
							{
								app2.callFromJavascript(trigger_value);
							}
						});
						
						var myaction = "";
						var mysensor = "";
						
						function submitAction(action)
						{
							myaction = action;
							$('#trigger_form').submit();
						}

						// prevents form from submitting and sends a message to server
						$('#trigger_form').submit(function(){
							var send_data = $('#control_slc').val()+"##"+myaction+"##"+mysensor;
							socket.emit('trigger_parameter', send_data);
							this.reset();				
							return false;
						});
						
						function changeControlSelection(myselection)
						{
							$('html').css({background : 'url(image/'+myselection.value+'.jpg)'});
							
							if(myselection.value == "smartbotanica")
							{
								$('#table_log tbody').html('');
								loadDataLog();
								
								$("#table_log").css('display', 'block');
								$("#read_btn").css('display', 'block');
								$("#trigger_btn").css('display', 'block');
							}
							else
							{
								$("#table_log").css('display', 'none');
								$("#read_btn").css('display', 'none');
								$("#trigger_btn").css('display', 'none');
							}
						}
						
						function loadDataLog() 
						{
							var values = {
								'project_value': $('#control_slc').val()
							};
									
							$.ajax({
								type: "POST",
								url: "/loadlog",
								data: values,
								timeout: 3000,
								success: function(data)
								{
									$("#table_log tbody").prepend(data);
								}
							});
							return false;
						}
						
						function sensorUpdate(sensorval)
						{
							document.getElementById("logo").style.display = "none";
							myaction = "Check Sensor";
							mysensor = sensorval;
							$('#trigger_form').submit();
						}
						
						function exitNow(){
							app.callFromJavascript();
						}

				</script>  
    </body>
</html>  